String.prototype.toBytes=function(t=!1){let e=[];t||(e.push(255&this.length),e.push(this.length>>8&255));for(let n=0;n<this.length;n++)e.push(this.charCodeAt(n));return e},String.prototype.fromBytes=function(t,e=-1){e<0&&(e=t[0]|t[1]<<8);let n='';for(let o=0;o<e;o++)n+=String.fromCharCode(t[o+2]);return n},Number.prototype.toBytes=function(){let t=[];return t.push(this>=0?0:1),t.push(this&255),t.push(this>>8&255),t},Number.prototype.fromBytes=function(t){return 0===t[0]?t[1]|t[2]<<8:-(t[1]|t[2]<<8)},(()=>{let t=new WebSocket(`ws://${location.host}:80/event`),e=0,n=1e4,o=null,r=null;function i(t){let e=JSON.parse(t.data);console.log(e);let n=e.data;if(200===e.status){for(let o of n.update)c(o);for(let r of n.remove)a(r)}}function s(){console.log('Disconnected'),location.reload()}function f(){clearInterval(r),console.log('Connected'),o=setInterval(p,n)}function l(t){console.log(t)}function u(t){return document.querySelector(`[app-id='${t}']`)}function a(t){let e=u(t);e&&e.remove()}function c(t){let e=u(t['app-id']);if(e){for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);for(let n in t.attributes)e.setAttribute(n,t.attributes[n]);if(t.innerText&&(e.innerText=t.innerText),t.tag&&t.tag!==e.tagName){let o=document.createElement(t.tag);for(let r in e.attributes)o.setAttribute(r,e.attributes[r]);for(o.innerText=e.innerText;e.firstChild;)o.appendChild(e.firstChild);e.replaceWith(o)}}}function p(){!(Date.now()-e<n)&&(e=Date.now())}function h(n,o){u(n).addEventListener(o,r=>{e=Date.now();let i=new Uint8Array($(o,n,r.target.value));console.log(i),t.send(i)})}function $(t,e,n){void 0===n?n='':'string'!=typeof n&&(n=String(n));let o=[];return(o=(o=(o=(o=o.concat(t.length.toBytes())).concat(n.length.toBytes())).concat(t.toBytes(!0))).concat(e.toBytes(!0))).concat(n.toBytes(!0))}t.onopen=f,t.onmessage=i,t.onclose=s,t.onerror=l,window.app={addEvent:h}})();